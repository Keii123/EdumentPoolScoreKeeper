@model PoolScoreKeeper.Models.HomeIndexViewModel

@{
    ViewBag.Title = "Home Page";
}

<div class="row">
    <div class="col-md-4">
        <div class="player-wrapper">
            <img src="~/Images/gold_medal.png" class="medal" />
            <div class="styled-select">
                <select id="winnerSelect" class="form-control">
                    <option>Select winner</option>
                    @foreach (var player in Model.Players)
                    {
                        <option value="@player.Id">@player.FirstName @player.LastName</option>
                    }
                </select>
                <div class="eightball">
                    <input id="winnerPocketedEightball" type="radio" name="winnerPocketedEightball" checked class="hidden" />
                    <img src="~/Images/eightball.png" class="eightball-radio-btn active-eightball" />
                </div>
            </div>


        </div>
    </div>

    <div class="col-md-4 text-center">
        <div id="registerGame" class="btn btn-success btn-lg text-uppercase submit-btn">Submit Game</div>
    </div>

    <div class="col-md-4">
        <div class="player-wrapper">
            <img src="~/Images/silver_medal.png" class="medal" />
            <div class="styled-select">
                <select id="loserSelect" class="form-control">
                    <option>Select runner up</option>
                    @foreach (var player in Model.Players)
                    {
                        <option value="@player.Id">@player.FirstName @player.LastName</option>
                    }
                </select>
                <div class="eightball">
                    <input id="loserPocketedEightball" type="radio" name="winnerPocketedEightball" class="hidden"/>
                    <img src="~/Images/eightball.png" class="eightball-radio-btn"/>
                </div>
            </div>
        </div>
    </div>
</div>

<table class="table table-striped">
    <thead>
        <tr>
            <th>
                <div class="row">
                    <div class="col-xs-4"></div>
                    <div class="col-xs-4">Wins&darr;</div>
                    <div class="col-xs-4">Losses&rarr;</div>
                </div>
            </th>
            @foreach (var player in Model.Players)
            {
                <th data-player-name="@(player.FirstName + " " + player.LastName)">@player.FirstName</th>
            }
        </tr>
    </thead>
    <tbody>
        @for (int i = 0; i < Model.Scores.GetLength(0); i++)
        {
            var player = Model.Players[i];
            <tr data-player-name="@(player.FirstName + " " + player.LastName)">
                @{
                    var wins = 0;
                    var losses = 0;
                    for (int j = 0; j < Model.Scores.GetLength(0); j++)
                    {
                        wins += Model.Scores[i, j];
                        losses += Model.Scores[j, i];
                    }
                }
                <td>@player.FirstName "@player.NickName" @player.LastName (@wins/@losses)</td>
                @for (int j = 0; j < Model.Scores.GetLength(1); j++)
                {
                    if (i == j)
                    {
                        <td>-</td>
                    }
                    else
                    {
                        <td>@Model.Scores[i, j]</td>
                    }
                }
            </tr>
                    }
    </tbody>
    <tfoot>
        <tr>
            <th>
                <div class="row">
                    <div class="col-xs-4"></div>
                    <div class="col-xs-4">Wins&uarr;</div>
                    <div class="col-xs-4">Losses&rarr;</div>
                </div>
            </th>
            @foreach (var player in Model.Players)
            {
                <th>@player.FirstName</th>
            }
        </tr>
    </tfoot>
</table>


<script>
    $(function () {
        $('#registerGame').click(function () {
            if ($("#loserSelect").val() === "Select runner up" || $("#winnerSelect").val() === "Select winner") {
                Notify("Select both winner and runner up", "danger", false);
                return;
            }
            $.ajax({
                url: '/Home/RegisterGame',
                data: {
                    WinnerId: $('#winnerSelect').val(),
                    LoserId: $('#loserSelect').val(),
                    WinnerPocketedEightball: $('#winnerPocketedEightball').is(':checked')
                }
            }).done(function (result) {
                var type = result.substring(0, result.length) === "Game Registered succesfull" ? "success" : "danger";
                Notify(result, type, type === "success" ? true : false);
            });
        });

        $(".eightball-radio-btn").click(function() {
            if ($(this).hasClass("active-eightball")) {
                return;
            }
            $(".eightball-radio-btn").toggleClass("active-eightball");
            $(this).siblings('input[type="radio"]').prop("checked", true);
        });

        $("select").change(function () {
            $(".intersect-highlight").removeClass("intersect-highlight");
            var player = $(this).find("option:selected").text();
            var playerIndex = $('th[data-player-name="' + player + '"]').index() + 1;
            var playerColumn = $('table tr td:nth-child(' + playerIndex + ')');
            var playerRow = $('tr[data-player-name="' + player + '"]');

            var classToUse = $(this).is("#winnerSelect") ? "winner-highlight" : "loser-highlight";
            $("table tr, table tr td").removeClass(classToUse);
            playerColumn.addClass(classToUse);
            playerRow.children("td").addClass(classToUse);
            $(".winner-highlight.loser-highlight").addClass("intersect-highlight");
        });
    });

    function Notify(message, type, reload, delay) {
        if (message === undefined)
            return;
        if (type === undefined)
            type = 'info';
        if (delay === undefined)
            delay = 2000;
        $.notify({
            // options
            message: message
        }, {
            // settings
            type: type,
            placement: {
                from: "top",
                align: "center"
            },
            offset: {
                y: 133
            },
            delay: delay,
            onClosed: function () {
                if (reload) {
                    location.reload();
                }
            }
        });
    }
</script>
